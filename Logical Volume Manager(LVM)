Logical Volume Manager(LVM):
What is LVM (Logical Volume Management)?
LVM = Logical Volume Management
It is a way to manage disks flexibly in Linux.
Normally, if you create partitions directly on a disk, it‚Äôs hard to resize or combine them later.

With LVM, you can:
Combine multiple disks into one large storage pool
Create logical volumes (like virtual partitions) from that pool
Easily extend or shrink them later without losing data

Why LVM
LVM is used because it gives flexibility:
Combine multiple disks
Extend space easily
Take snapshots for backup or recovery
Manage storage dynamically

When do we use LVM?
You use LVM when:
You want to increase disk size later without downtime
You want to combine multiple disks into one large space
You want to take snapshots (for backup)
You want flexible disk management (resize anytime)

üëâ Example:
You have an EC2 instance with 8GB root disk, and you attach two new 10GB EBS volumes.
You can combine those two 10GB disks into a single 20GB storage using LVM.
üü¢ Example:
You start with 10GB, later attach another 10GB ‚Äî with LVM you can merge them into one 20GB storage without losing data.

üß± How LVM Works (Simple)
LVM has 3 layers:
| Layer                    | Meaning                                                     | Example                    |
| ------------------------ | ----------------------------------------------------------- | -------------------------- |
| **PV (Physical Volume)** | Actual disk or partition                                    | `/dev/xvdf` or `/dev/xvdg` |
| **VG (Volume Group)**    | Pool of storage made from one or more PVs                   | `vg_data`                  |
| **LV (Logical Volume)**  | Virtual partition created from the VG, used by applications | `/dev/vg_data/lv_backup`   |

üìä Diagram (easy to visualize)
+---------------------------+
| Disk1 /dev/xvdf (10GB)    |  ---> PV
| Disk2 /dev/xvdg (10GB)    |  ---> PV
+-------------+-------------+
              ‚Üì
       Volume Group (VG)
        [ vg_data (20GB) ]
              ‚Üì
   +---------------------------+
   | Logical Volumes (LVs)     |
   | lv_backup (8GB)           |
   | lv_logs (12GB)            |
   +---------------------------+
So, LVs = partitions created inside the VG, and the VG is built using PVs (disks)

ü™ú Step-by-Step Example (Simple Commands)
Step 1Ô∏è‚É£ ‚Äî Check your disks
lsblk

output:
xvda   8G
xvdf   10G
xvdg   10G


We‚Äôll use /dev/xvdf and /dev/xvdg for LVM.

2.
Creating Physical Volume (PV)
Now make it a Physical Volume (PV):
sudo pvcreate /dev/xvdf1
Check:
sudo pvdisplay

3.
Creating Volume Group (VG)
Combine one or more PVs into a Volume Group:
sudo vgcreate vg_data /dev/xvdf1
Check:
sudo vgdisplay
üü¢ Think of VG as a pool of storage you can cut into pieces later.

4.
Creating Logical Volume (LV)
From the VG, create a Logical Volume (virtual partition):
sudo lvcreate -L 5G -n lv_backup vg_data
Check:
sudo lvdisplay
5.
Creating File System
You need to format the LV before use:
sudo mkfs.ext4 /dev/vg_data/lv_backup
6.
Then mount it:
sudo mkdir /mnt/backup
sudo mount /dev/vg_data/lv_backup /mnt/backup
Now use /mnt/backup like normal storage.
7.
Extending Logical Volume
You want to increase its size (say +2GB):
sudo lvextend -L +2G /dev/vg_data/lv_backup
Now LV size is 7GB, but filesystem is still 5GB ‚Äî so we must resize it.
8.
Resizing the Volume (Filesystem)
To make Linux recognize the extra space:
sudo resize2fs /dev/vg_data/lv_backup
or if it‚Äôs XFS:
sudo xfs_growfs /mnt/backup

Now, when you check:
df -h
you‚Äôll see the bigger size.

Creating Snapshot(temporary storage)
Snapshot is like a ‚Äúphoto‚Äù of your LV at a point in time.
Create it:
sudo lvcreate -L 1G -s -n lv_backup_snap /dev/vg_data/lv_backup

Mount snapshot to check or recover files:
sudo mkdir /mnt/snap
sudo mount /dev/vg_data/lv_backup_snap /mnt/snap

Recover Deleted Data (Merging Snapshot)
If you accidentally delete files in LV, but you have a snapshot ‚Äî
you can roll back using:
sudo umount /mnt/backup
sudo umount /mnt/snap
sudo lvconvert --merge /dev/vg_data/lv_backup_snap
sudo mount /mnt/backup
Your data returns to the state before deletion.

Quick Command Flow (Cheat Sheet)
# 1. Create partition
fdisk /dev/xvdf
partprobe /dev/xvdf

# 2. Create Physical Volume
pvcreate /dev/xvdf1

# 3. Create Volume Group
vgcreate vg_data /dev/xvdf1

# 4. Create Logical Volume
lvcreate -L 5G -n lv_backup vg_data

# 5. Format and mount
mkfs.ext4 /dev/vg_data/lv_backup
mkdir /mnt/backup
mount /dev/vg_data/lv_backup /mnt/backup

# 6. Extend LV
lvextend -L +2G /dev/vg_data/lv_backup
resize2fs /dev/vg_data/lv_backup

# 7. Snapshot
lvcreate -L 1G -s -n lv_backup_snap /dev/vg_data/lv_backup

# 8. Recover (merge snapshot)
lvconvert --merge /dev/vg_data/lv_backup_snap


| Step                   | Command             | What it does                 |
| ---------------------- | ------------------- | ---------------------------- |
| `fdisk`                | Create partition    | Divide disk                  |
| `partprobe`            | Refresh kernel      | Make Linux see new partition |
| `pvcreate`             | Make disk LVM-ready | Convert to Physical Volume   |
| `vgcreate`             | Make a storage pool | Combine PVs into VG          |
| `lvcreate`             | Make usable space   | Create Logical Volume        |
| `mkfs`                 | Format volume       | Prepare to store files       |
| `mount`                | Attach to folder    | Make it usable               |
| `lvextend + resize2fs` | Increase size       | Extend storage               |
| `lvcreate -s`          | Snapshot            | Backup point                 |
| `lvconvert --merge`    | Merge snapshot      | Recover deleted data         |
